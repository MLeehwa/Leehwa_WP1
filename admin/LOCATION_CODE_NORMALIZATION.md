# 위치 코드 정규화 확인 보고서

## 개선 사항 요약

시스템 개선 과정에서 위치 코드 정규화를 일관되게 적용하여 기존 데이터와의 호환성을 보장했습니다.

## 수정된 파일 및 내용

### 1. `admin/js/receiving.js`
- ✅ **입고 계획 등록 시 정규화**: `submitPlanBtn` 클릭 핸들러와 `handleSubmitPlan` 함수에서 위치 코드 저장 시 정규화 적용
- ✅ **사용 가능한 위치 조회 시 정규화**: `getAvailableLocations()` 함수에서 위치 코드 비교 시 정규화 적용
- ✅ **위치 등록 폼 정규화**: `addLocationForm` 제출 시 위치 코드 정규화 적용

### 2. `admin/js/location_view.js`
- ✅ **위치 레이아웃 로드 시 정규화**: `loadLocationLayout()` 함수에서 DB에서 가져온 위치 코드를 정규화하여 `layout` 배열에 저장
- ✅ **점유 위치 조회 시 정규화**: `loadOccupied()` 함수에서 `normalizeLocationCode()` 함수 사용으로 통일
- ✅ **위치 비교 시 정규화**: `getAvailableLocationsForView()` 함수에서 위치 코드 비교 시 정규화 적용

### 3. `admin/js/location_master.js`
- ✅ **정규화 함수 추가**: `normalizeLocationCode()` 함수 추가
- ✅ **위치 등록 시 정규화**: 위치 마스터에서 새 위치 등록 시 위치 코드 정규화 적용

## 정규화 규칙

`normalizeLocationCode()` 함수는 다음 형식을 모두 `A-01` 형식으로 변환합니다:
- `A1` → `A-01`
- `A-1` → `A-01`
- `A 1` → `A-01`
- `A01` → `A-01`
- `A-01` → `A-01` (이미 정규화된 경우)

## 기존 데이터 호환성

### 문제점
- 기존 DB 데이터에는 `A1`, `A-01`, `A 1` 등 다양한 형식이 혼재되어 있을 수 있음
- 새로 저장되는 데이터는 `A-01` 형식으로 정규화됨

### 해결 방법
1. **저장 시 정규화**: 모든 위치 코드 저장 시 정규화 적용
2. **비교 시 정규화**: 위치 코드 비교 시 양쪽 모두 정규화하여 비교
3. **조회 시 정규화**: DB에서 조회한 위치 코드를 정규화하여 사용

## 확인된 안전성

### ✅ 안전한 부분
- 입고 계획 등록: 위치 코드 정규화 적용됨
- 위치 보기: `layout`과 `currentOccupied` 모두 정규화되어 매칭 정확함
- 사용 가능한 위치 조회: 정규화된 위치 코드로 비교하여 정확함
- 위치 마스터: 새 위치 등록 시 정규화 적용됨

### ⚠️ 주의사항
- 기존 DB에 저장된 위치 코드는 그대로 유지됨 (마이그레이션 필요 시 별도 작업)
- 위치 코드 비교/조회 시 항상 `normalizeLocationCode()` 함수 사용 필요
- 새로운 위치 코드 입력 시 자동으로 정규화되어 저장됨

## 권장 사항

1. **기존 데이터 마이그레이션** (선택사항): 기존 DB의 위치 코드를 정규화하려면 별도 마이그레이션 스크립트 실행
2. **일관성 유지**: 모든 위치 코드 관련 작업에서 `normalizeLocationCode()` 함수 사용
3. **테스트**: 다양한 형식의 위치 코드 입력 테스트 (`A1`, `A-1`, `A 1` 등)

## 결론

위치 코드 정규화가 일관되게 적용되어 기존 데이터와의 호환성을 보장하며, 새로운 데이터는 자동으로 정규화되어 저장됩니다. 시스템 전반에 걸쳐 위치 코드 비교 및 조회가 정확하게 작동합니다.
